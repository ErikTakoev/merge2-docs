# Візуальні Ефекти (Visual Effects)

[← На Головну](../Main.md)

Цей документ описує систему візуальних ефектів, що використовуються для забезпечення зворотного зв'язку (Feedback) гравцеві під час взаємодії з фішками (Chips) на ігровому полі.

## Базова Система

### `Effect.cs`
Базовий клас для всіх ефектів. Надає віртуальні методи для керування життєвим циклом ефекту:
- **`Init(Chip chip)`**: Ініціалізує ефект, налаштовує позицію залежно від розміру чіпа, деактивує за замовчуванням.
- **`Activate(Chip chip)`**: Вмикає об'єкт ефекту.
- **`Deactivate(Chip chip)`**: Вимикає об'єкт ефекту.
- **`OnChangedCell(Cell sourceCell, Cell targetCell)`**: Викликається при переміщенні фішки. Якщо `effectForCell` встановлено в `true`, ефект переприв'язується до трансформу клітинки, а не фішки.
- **`OnInteractionOverCellChanged` / `OnInteractionUnderCellChanged`**: Обробка зміни клітин над якими або під якими знаходиться фішка під час Drag-and-Drop.

**Додаткові можливості**:
- **Animator Integration**: Якщо налаштовано `sendAnimatorTrigger`, методи `Activate` та `Deactivate` автоматично відправляють тригери `"Activate"` та `"Deactivate"` в компонент `Animator`.
- **`SendTrigger(string triggerName)`**: Дозволяє відправити довільний тригер в `Animator` ефекту. Використовується для спеціальних взаємодій, таких як анімація при спробі перетягнути заблокований чіп (`MoveLocked`).

---

## Реалізовані Ефекти

### 1. Cell Highlight (Підсвітка Клітин)
**Клас**: `CellHighlightEffect.cs`
**Використовується в**: [Chip](../Chips/Chip.md)

Динамічно створює та відображає підсвітку під фішкою. Підтримує багатокоміркові фішки, створюючи сітку хайлайтів відповідно до розміру (`Size`) фішки.
- **Параметри**:
  - `highlightPrefab`: Префаб візуального елемента підсвітки.
  - `color`: Колір підсвітки.
  - `order`: Зсув по осі Z для правильного рендерингу над полем.

### 2. Merge Available (Доступність Злиття)
**Клас**: `ChipMergeAvailableEffect.cs`
**Використовується в**: [Chip](../Chips/Chip.md)

Активується на фішці, яка знаходиться "знизу", коли гравець заносить над нею іншу фішку, з якою можливе злиття.
- **Особливості**:
  - `autoSize`: Автоматично масштабує ефект під розмір фішки.
  - `autoPosition`: Центрує ефект відносно фішки.
  - Використовує `Animator` з тригерами `Activate` та `Deactivate`.

### 3. Chip Generator Recharge (Прогрес Генератора)
**Клас**: `ChipGeneratorRechargeEffect.cs`
**Використовується в**: [ChipGenerator](../Chips/ChipGenerator.md)

Візуалізує процес перезарядки генератора. Зазвичай реалізовано через зміну локальної позиції маски (`maskRectTransform`), що створює ефект заповнення іконки знизу вгору.
- **Метод `OnCharging(float progress)`**: Отримує значення від 0 до 1 та оновлює візуалізацію.

### 4. Chip Container (Вимоги Контейнера)
**Клас**: `ChipContainerEffect.cs`
**Використовується в**: [ChipContainer](../Chips/ChipContainer.md)

Відображає Panel з іконками предметів, які необхідні контейнеру для виконання квесту.

- **Компоненти**:
  - `Animator`: Керує анімацією появи (`Activate`) та зникнення (`Deactivate`) панелі.
  - `LayoutForElements`: Контейнер для іконок предметів.
  - `PanelSpriteRenderer`: Фон, розмір якого адаптується під кількість елементів.
- **Конфігурація (`ElementInfo`)**:
  - Ефект містить масив налаштувань для різної кількості елементів (наприклад, для 1 або 2 предметів).
  - Кожен запис налаштовує ширину панелі, ширину layout-групи та масштаб іконок.
- **Логіка (`UpdateElements`)**:
  1. Отримує поточний список вимог (`containers`).
  2. Знаходить відповідний `ElementInfo` на основі кількості вимог.
  3. Адаптує розмір фону та групи.
  4. Очищає старі елементи та створює нові префаби (`ContainerElementPrefab`) для кожної вимоги.
  5. Якщо контейнер заповнений (`isFull`), викликає `ClearElements` та деактивує ефект.

### 5. Generator Charged (Готовність Генератора)
**Використовується в**: [ChipGenerator](../Chips/ChipGenerator.md)

Візуальний ефект, що активується, коли генератор повністю зарядився і готовий до створення нової фішки.
- **Активація**: Коли `IsCharged` стає `true` (через поле `chargedEffect`).
- **Деактивація**: Після успішної генерації фішки або під час процесу перезарядки.
- **Тип**: Використовує базовий клас `Effect`. Зазвичай це cyclic idle-анімація (світіння, пульсація), що показує гравцеві готовність об'єкта до взаємодії.

### 6. Move Locked (Блокування Переміщення)
**Клас**: `Effect` (базовий)
**Використовується в**: [Chip](../Chips/Chip.md)

Візуальний ефект, що відображається на чіпі, коли його переміщення заблоковано.
- **Активація**: 
  - Коли `ChipRuntimeData.IsMoveLocked` встановлено в `true` через метод `SetRealtimeData()`.
  - Автоматично викликається в `Chip.SetRealtimeData()`.
- **Деактивація**: 
  - Коли `IsMoveLocked` стає `false`.
  - Автоматично викликається в `Chip.SetRealtimeData()`.
- **Поведінка**:
  - Використовує базовий клас `Effect` з підтримкою Animator triggers (`Activate`/`Deactivate`).
  - Зазвичай реалізовано як іконка замка або інший візуальний індикатор, що показує гравцеві неможливість переміщення.
  - Перевірка можливості переміщення виконується через метод `Chip.CanMoving()`, який використовується в `DraggableChipLogic`.
  - **Інтерактивний зворотний зв'язок**: При спробі перетягнути заблокований чіп викликається `Chip.OnDraggingChipWithMoveLocked()`, який відтворює спеціальну анімацію `MoveLocked` через метод `Effect.SendTrigger()`. Це дозволяє показати гравцеві, що чіп заблокований, навіть якщо він намагається його перемістити.
- **Налаштування**:
  - Префаб ефекту задається в `ChipData.MoveLockedEffectPrefab`.
  - Створюється автоматично в `Chip.Init()`, якщо префаб вказано.
