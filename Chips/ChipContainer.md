# ChipContainer (Контейнер)

[← На Головну](../Main.md)

`ChipContainer` — це інтерактивна фішка, яка приймає в себе інші фішки для виконання квестів або замовлень. Вона успадковується від базового класу `Chip` і розширює його функціонал можливістю накопичення предметів.

## Архітектура та Відповідальність

### 1. `ChipContainer.cs` (Контейнер)
Клас `ChipContainer` зберігає стан наповнення та керує візуальними ефектами.
- **Властивості (Data)**:
  - `ChipContainerData`: Налаштування контейнера (список необхідних предметів, нагорода `NextChipData`).
  - `containers`: Словник (`Dictionary`), що відслідковує поточний прогрес заповнення.
- **Події**:
  - `OnFillContainer`: Подія, що викликається при додаванні предмету або заповненні контейнера.
- **Ефекти**:
  - `ChipContainerEffect`: Спеціальний ефект, який візуалізує необхідні предмети ("бабли") над контейнером.

### 2. `FillContainerLogic.cs` (Логіка)
Логіка взаємодії (Drag-and-Drop) реалізована в окремому класі.
- **Перевірка (`CanInteract`)**:
  - Перевіряє, чи є ціль контейнером (`ChipContainer`).
  - Викликає метод `IsChipCompatible` у самого контейнера, щоб дізнатись, чи підходить конкретна фішка.
- **Виконання (`ExecuteInteraction`)**:
  - Викликає `TryAddChip` у контейнера.
  - Якщо успішно — знищує фішку, яку перетягнули.

## Ключові Методи (`ChipContainer.cs`)

### `IsChipCompatible(Chip chip)`
Перевіряє, чи підходить фішка за типом (`ChipType`) або ID (`ChipId`) до однієї з незаповнених вимог контейнера. Не змінює стан контейнера.

### `TryAddChip(Chip chip)`
Спроба додати фішку:
1. Знаходить відповідну вимогу в `containers`.
2. Збільшує лічильник зібраних предметів.
3. Викликає подію `OnFillContainer` (оновлює візуалізацію).
4. Якщо вимога виконана повністю — видаляє її зі списку очікування.
5. **Завершення**: Якщо всі вимоги виконані, контейнер знищується, а на його місці створюється `NextChipData` (нагорода).

## Візуальні Ефекти (`ChipContainerEffect.cs`)
- **Activate/Deactivate**: Керує анімацією появи/зникнення.
- **UpdateElements**: Динамічно створює та оновлює іконки необхідних предметів над контейнером залежно від поточного стану (адаптується під 1 або 2 типи предметів).

## Процес (Flow)

1. **Input**: Гравець перетягує фішку на контейнер.
2. **Move**: `DraggableChipLogic` через `FillContainerLogic` запитує `CanInteract`.
3. **Logic**: `FillContainerLogic` делегує перевірку самому контейнеру (`IsChipCompatible`).
4. **Drop**: При відпусканні викликається `ExecuteInteraction` -> `TryAddChip`.
5. **Update**: Контейнер оновлює свій стан, `ChipContainerEffect` оновлює іконки.
6. **Complete**: Якщо контейнер повний, він перетворюється на нову фішку.
